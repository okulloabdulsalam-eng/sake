<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Library - KIUMA</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <nav class="nav-menu" id="navMenu">
        <div class="nav-header">
            <span class="nav-close" id="navClose"><i class="fas fa-times"></i></span>
        </div>
        <ul class="nav-list">
            <li><a href="index.html" class="nav-link"><i class="fas fa-home"></i> Home</a></li>
            <li><a href="about.html" class="nav-link"><i class="fas fa-info-circle"></i> About</a></li>
            <li><a href="values.html" class="nav-link"><i class="fas fa-heart"></i> Values</a></li>
            <li><a href="programs.html" class="nav-link"><i class="fas fa-book"></i> Programs</a></li>
            <li><a href="activities.html" class="nav-link"><i class="fas fa-running"></i> Activities</a></li>
            <li><a href="events.html" class="nav-link"><i class="fas fa-calendar-alt"></i> Events</a></li>
            <li><a href="leadership.html" class="nav-link"><i class="fas fa-users"></i> Leadership</a></li>
            <li><a href="contact.html" class="nav-link"><i class="fas fa-phone"></i> Contact</a></li>
            <li><a href="library.html" class="nav-link active"><i class="fas fa-book-open"></i> Library</a></li>
            <li><a href="media.html" class="nav-link"><i class="fas fa-photo-video"></i> Media</a></li>
            <li><a href="ask-question.html" class="nav-link"><i class="fas fa-question-circle"></i> Ask Question</a></li>
            <li><a href="join-programs.html" class="nav-link"><i class="fas fa-user-plus"></i> Join Programs</a></li>
            <li><a href="notifications.html" class="nav-link"><i class="fas fa-bell"></i> Notifications</a></li>
            <li><a href="pay.html" class="nav-link"><i class="fas fa-credit-card"></i> Pay</a></li>
            <li><a href="join-us.html" class="nav-link"><i class="fas fa-user-circle"></i> My Account</a></li>
        </ul>
    </nav>

    <div class="container">
        <header class="header">
            <div class="header-content">
                <button class="menu-toggle" id="menuToggle"><i class="fas fa-bars"></i></button>
                <div class="logo-container">
                    <img src="logo.png" alt="KIUMA Logo" class="header-logo" onerror="this.style.display='none'; if(this.nextElementSibling) this.nextElementSibling.style.display='block';" onload="this.style.display='block'; if(this.nextElementSibling) this.nextElementSibling.style.display='none';">
                    <svg class="header-logo-svg" viewBox="0 0 200 200" xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <circle cx="100" cy="100" r="95" fill="none" stroke="#4CAF50" stroke-width="4"/>
                        <path id="topArc" d="M 20,100 A 80,80 0 0,1 180,100" fill="none"/>
                        <text fill="#4CAF50" font-size="9" font-weight="bold" font-family="Arial, sans-serif" letter-spacing="0.5">
                            <textPath href="#topArc" startOffset="50%" text-anchor="middle">KAMPALA INTERNATIONAL UNIVERSITY</textPath>
                        </text>
                        <path id="bottomArc" d="M 180,100 A 80,80 0 0,1 20,100" fill="none"/>
                        <text fill="#4CAF50" font-size="9" font-weight="bold" font-family="Arial, sans-serif" letter-spacing="0.5">
                            <textPath href="#bottomArc" startOffset="50%" text-anchor="middle">MUSLIM ASSOCIATION</textPath>
                        </text>
                        <path d="M 50,75 L 50,115 L 58,115 L 58,105 L 63,100 L 58,95 L 58,85 Z" fill="none" stroke="#4CAF50" stroke-width="2"/>
                        <circle cx="56.5" cy="100" r="2" fill="#4CAF50"/>
                        <rect x="88" y="65" width="10" height="45" fill="none" stroke="#4CAF50" stroke-width="2"/>
                        <rect x="90" y="75" width="6" height="2" fill="#4CAF50"/>
                        <rect x="90" y="85" width="6" height="2" fill="#4CAF50"/>
                        <rect x="90" y="95" width="6" height="2" fill="#4CAF50"/>
                        <polygon points="93,60 90,65 96,65" fill="#4CAF50"/>
                        <path d="M 140,92 A 12,12 0 0,1 128,92 A 10,10 0 0,0 140,92 Z" fill="#4CAF50"/>
                        <path d="M 130,88 L 131.5,92 L 136,92 L 132.5,94.5 L 134,99 L 130,96.5 L 126,99 L 127.5,94.5 L 124,92 L 128.5,92 Z" fill="#4CAF50"/>
                        <text x="100" y="145" font-size="22" font-weight="bold" fill="#4CAF50" text-anchor="middle" font-family="Arial, sans-serif" letter-spacing="2">KIUMA</text>
                    </svg>
                </div>
                <button class="notifications-btn" id="notificationsBtn">
                    <i class="fas fa-bell"></i>
                    <span class="badge" style="display: none;">0</span>
                </button>
            </div>
        </header>

        <main class="main-content">
            <!-- Welcome Section -->
            <section class="welcome-section">
                <div>
                    <h2 class="greeting">
                        <a href="about.html">KIUMA</a>
                    </h2>
                </div>
                <a href="join-us.html" class="account-icon-btn" id="accountIconBtn">
                    <i class="fas fa-user-circle" id="accountIcon"></i>
                </a>
            </section>

            <section class="page-header" style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 10px;">
                <h2 class="page-title">Library</h2>
                <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                    <button class="btn btn-secondary" id="adminLoginBtn" onclick="showAdminLogin()" style="padding: 10px 15px;">
                        <i class="fas fa-lock"></i> Admin Login
                    </button>
                    <button class="btn btn-primary admin-only" onclick="showAddBookModal()" style="display: none; padding: 10px 15px;">
                        <i class="fas fa-plus"></i> Add Book
                    </button>
                    <button class="btn btn-secondary admin-logout" onclick="if(typeof window.logoutAdmin==='function')window.logoutAdmin()" style="display: none; padding: 10px 15px;">
                        <i class="fas fa-sign-out-alt"></i> Logout
                    </button>
                </div>
            </section>

            <section class="page-content">
                <!-- Category Cards Grid -->
                <div class="category-cards-grid" style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px; margin-bottom: 24px;">
                    <!-- All Category Card -->
                    <div class="category-card active" data-category="all" onclick="if(typeof window.filterBooks==='function')window.filterBooks('all')" style="background: linear-gradient(135deg, #4CAF50, #388E3C); border-radius: 12px; padding: 16px; cursor: pointer; box-shadow: 0 2px 8px rgba(0,0,0,0.1); transition: transform 0.2s, box-shadow 0.2s; touch-action: manipulation;">
                        <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 8px;">
                            <i class="fas fa-th" style="font-size: 24px; color: white;"></i>
                            <span class="category-badge" style="background: rgba(255,255,255,0.3); color: white; padding: 4px 8px; border-radius: 12px; font-size: 12px; font-weight: 600;" id="count-all">0</span>
                        </div>
                        <div style="color: white; font-size: 16px; font-weight: 600;">All</div>
                    </div>
                    
                    <!-- Quran Category Card -->
                    <div class="category-card" data-category="quran" onclick="if(typeof window.filterBooks==='function')window.filterBooks('quran')" style="background: linear-gradient(135deg, #4CAF50, #388E3C); border-radius: 12px; padding: 16px; cursor: pointer; box-shadow: 0 2px 8px rgba(0,0,0,0.1); transition: transform 0.2s, box-shadow 0.2s; touch-action: manipulation;">
                        <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 8px;">
                            <i class="fas fa-quran" style="font-size: 24px; color: white;"></i>
                            <span class="category-badge" style="background: rgba(255,255,255,0.3); color: white; padding: 4px 8px; border-radius: 12px; font-size: 12px; font-weight: 600;" id="count-quran">0</span>
                        </div>
                        <div style="color: white; font-size: 16px; font-weight: 600;">Quran</div>
                    </div>
                    
                    <!-- Yasaruna Category Card -->
                    <div class="category-card" data-category="yasaruna" onclick="if(typeof window.filterBooks==='function')window.filterBooks('yasaruna')" style="background: linear-gradient(135deg, #2196F3, #1976D2); border-radius: 12px; padding: 16px; cursor: pointer; box-shadow: 0 2px 8px rgba(0,0,0,0.1); transition: transform 0.2s, box-shadow 0.2s; touch-action: manipulation;">
                        <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 8px;">
                            <i class="fas fa-book-open" style="font-size: 24px; color: white;"></i>
                            <span class="category-badge" style="background: rgba(255,255,255,0.3); color: white; padding: 4px 8px; border-radius: 12px; font-size: 12px; font-weight: 600;" id="count-yasaruna">0</span>
                        </div>
                        <div style="color: white; font-size: 16px; font-weight: 600;">Yasaruna</div>
                    </div>
                    
                    <!-- Hadith Category Card -->
                    <div class="category-card" data-category="hadith" onclick="if(typeof window.filterBooks==='function')window.filterBooks('hadith')" style="background: linear-gradient(135deg, #FF9800, #F57C00); border-radius: 12px; padding: 16px; cursor: pointer; box-shadow: 0 2px 8px rgba(0,0,0,0.1); transition: transform 0.2s, box-shadow 0.2s; touch-action: manipulation;">
                        <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 8px;">
                            <i class="fas fa-book-reader" style="font-size: 24px; color: white;"></i>
                            <span class="category-badge" style="background: rgba(255,255,255,0.3); color: white; padding: 4px 8px; border-radius: 12px; font-size: 12px; font-weight: 600;" id="count-hadith">0</span>
                        </div>
                        <div style="color: white; font-size: 16px; font-weight: 600;">Hadith</div>
                    </div>
                    
                    <!-- Tauheed Category Card -->
                    <div class="category-card" data-category="tauheed" onclick="if(typeof window.filterBooks==='function')window.filterBooks('tauheed')" style="background: linear-gradient(135deg, #9C27B0, #7B1FA2); border-radius: 12px; padding: 16px; cursor: pointer; box-shadow: 0 2px 8px rgba(0,0,0,0.1); transition: transform 0.2s, box-shadow 0.2s; touch-action: manipulation;">
                        <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 8px;">
                            <i class="fas fa-star-and-crescent" style="font-size: 24px; color: white;"></i>
                            <span class="category-badge" style="background: rgba(255,255,255,0.3); color: white; padding: 4px 8px; border-radius: 12px; font-size: 12px; font-weight: 600;" id="count-tauheed">0</span>
                        </div>
                        <div style="color: white; font-size: 16px; font-weight: 600;">Tauheed</div>
                    </div>
                    
                    <!-- Swalah Category Card -->
                    <div class="category-card" data-category="swalah" onclick="if(typeof window.filterBooks==='function')window.filterBooks('swalah')" style="background: linear-gradient(135deg, #009688, #00796B); border-radius: 12px; padding: 16px; cursor: pointer; box-shadow: 0 2px 8px rgba(0,0,0,0.1); transition: transform 0.2s, box-shadow 0.2s; touch-action: manipulation;">
                        <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 8px;">
                            <i class="fas fa-mosque" style="font-size: 24px; color: white;"></i>
                            <span class="category-badge" style="background: rgba(255,255,255,0.3); color: white; padding: 4px 8px; border-radius: 12px; font-size: 12px; font-weight: 600;" id="count-swalah">0</span>
                        </div>
                        <div style="color: white; font-size: 16px; font-weight: 600;">Swalah</div>
                    </div>
                    
                    <!-- Others Category Card -->
                    <div class="category-card" data-category="others" onclick="if(typeof window.filterBooks==='function')window.filterBooks('others')" style="background: linear-gradient(135deg, #757575, #616161); border-radius: 12px; padding: 16px; cursor: pointer; box-shadow: 0 2px 8px rgba(0,0,0,0.1); transition: transform 0.2s, box-shadow 0.2s; touch-action: manipulation;">
                        <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 8px;">
                            <i class="fas fa-folder" style="font-size: 24px; color: white;"></i>
                            <span class="category-badge" style="background: rgba(255,255,255,0.3); color: white; padding: 4px 8px; border-radius: 12px; font-size: 12px; font-weight: 600;" id="count-others">0</span>
                        </div>
                        <div style="color: white; font-size: 16px; font-weight: 600;">Others</div>
                    </div>
                </div>
                
                <style>
                    .category-card:hover {
                        transform: translateY(-2px);
                        box-shadow: 0 4px 12px rgba(0,0,0,0.15) !important;
                    }
                    .category-card:active {
                        transform: translateY(0);
                    }
                    .category-card.active {
                        box-shadow: 0 4px 16px rgba(0,0,0,0.2) !important;
                        transform: scale(1.02);
                    }
                </style>

                <div class="media-grid" id="libraryGrid">
                    <!-- Books will be loaded here dynamically -->
                </div>

                <div class="info-card" style="margin-top: 20px;">
                    <h3><i class="fas fa-info-circle"></i> About Our Library</h3>
                    <p>Browse through our collection of Islamic books, educational resources, and Quranic studies materials. All books are carefully selected to support Islamic learning and community education.</p>
                </div>
            </section>
        </main>

        <nav class="bottom-nav">
            <a href="index.html" class="nav-item"><i class="fas fa-home"></i><span>Home</span></a>
            <a href="programs.html" class="nav-item"><i class="fas fa-book"></i><span>Programs</span></a>
            <a href="events.html" class="nav-item"><i class="fas fa-calendar"></i><span>Events</span></a>
            <a href="pay.html" class="nav-item"><i class="fas fa-credit-card"></i><span>Pay</span></a>
            <a href="join-us.html" class="nav-item" id="accountNavItem"><i class="fas fa-user-circle"></i><span id="accountNavText">Account</span></a>
        </nav>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="supabase-config.js"></script>
    <script type="module" src="js/library.js"></script>
    <script src="script.js"></script>
    <script src="update-navigation.js"></script>
    <script>
        // Define showAddBookModal immediately so it's available for onclick handlers
        window.showAddBookModal = function() {
            const adminStatus = localStorage.getItem('isAdminLoggedIn') === 'true';
            if (!adminStatus) {
                if (typeof window.showAdminLogin === 'function') {
                    window.showAdminLogin();
                } else {
                    alert('Please login as admin first. Click the "Admin Login" button.');
                }
                return;
            }
            const modal = document.getElementById('addBookModal');
            if (modal) {
                modal.style.display = 'flex';
                modal.style.visibility = 'visible';
                modal.style.zIndex = '9999';
                console.log('Add Book modal opened');
            } else {
                console.error('Add Book modal not found');
                alert('Error: Add Book form not found. Please refresh the page.');
            }
        };

        // Check admin status on page load
        window.addEventListener('DOMContentLoaded', function() {
            // Check admin status in background (non-blocking)
            if (typeof window.checkAdminStatus === 'function') {
                setTimeout(() => {
                    window.checkAdminStatus();
                }, 0);
            } else if (typeof checkAdminStatus === 'function') {
                setTimeout(() => {
                    checkAdminStatus();
                }, 0);
            }
            
            loadBooksFromStorage('all', true);
            
            // Refresh books in background every 30 seconds (only when page is visible)
            let refreshInterval = null;
            const startBackgroundRefresh = () => {
                if (refreshInterval) clearInterval(refreshInterval);
                refreshInterval = setInterval(() => {
                    // Only refresh if page is visible (saves battery/data)
                    if (!document.hidden) {
                        loadBooksFromStorage('all', false); // Silent refresh
                    }
                }, 30000);
            };
            
            // Start refresh when page is visible
            startBackgroundRefresh();
            
            // Pause refresh when page is hidden, resume when visible
            document.addEventListener('visibilitychange', () => {
                if (document.hidden) {
                    if (refreshInterval) clearInterval(refreshInterval);
                } else {
                    startBackgroundRefresh();
                }
            });
            
            // Initialize admin login modal
            const adminModal = document.getElementById('adminLoginModal');
            if (adminModal) {
                adminModal.addEventListener('click', function(e) {
                    if (e.target === adminModal) {
                        closeAdminLogin();
                    }
                });
            }
            
            // Allow Enter key to submit password
            const passwordInput = document.getElementById('adminPassword');
            if (passwordInput) {
                passwordInput.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        if (typeof window.verifyAdminPassword === 'function') {
                            window.verifyAdminPassword();
                        }
                    }
                });
            }

            // Close add book modal on overlay click
            const addBookModal = document.getElementById('addBookModal');
            if (addBookModal) {
                addBookModal.addEventListener('click', function(e) {
                    if (e.target === addBookModal) {
                        if (typeof window.closeAddBookModal === 'function') {
                            window.closeAddBookModal();
                        }
                    }
                });
            }
        });

        // Filter books function - globally accessible
        window.filterBooks = function(category) {
            // Update category card active states
            const categoryCards = document.querySelectorAll('.category-card');
            categoryCards.forEach(card => {
                const cardCategory = card.dataset.category || '';
                if (cardCategory === category) {
                    card.classList.add('active');
                } else {
                    card.classList.remove('active');
                }
            });
            
            // Instant client-side filtering (no reload)
            const adminStatus = localStorage.getItem('isAdminLoggedIn') === 'true';
            displayBooks(cachedBooks, category, adminStatus);
        };
        
        // Update category counts
        function updateCategoryCounts(books) {
            const categories = ['all', 'quran', 'yasaruna', 'hadith', 'tauheed', 'swalah', 'others'];
            
            categories.forEach(cat => {
                const badge = document.getElementById(`count-${cat}`);
                if (badge) {
                    let count = 0;
                    if (cat === 'all') {
                        count = books.length;
                    } else {
                        count = books.filter(book => {
                            const bookCategory = (book.category || 'others').toLowerCase();
                            return bookCategory === cat.toLowerCase();
                        }).length;
                    }
                    badge.textContent = count;
                }
            });
        }

        window.closeAddBookModal = function() {
            const modal = document.getElementById('addBookModal');
            if (modal) {
                modal.style.display = 'none';
            }
            const form = document.getElementById('uploadBookForm');
            if (form) {
                form.reset();
            }
        };

        /**
         * New Add Book handler - Supabase-only implementation
         * Uploads files to Supabase Storage, then inserts into books table
         */
        window.addBook = async function(e) {
            if (e) {
                e.preventDefault();
            }
            
            // Check admin login status
            const adminStatus = localStorage.getItem('isAdminLoggedIn') === 'true';
            if (!adminStatus) {
                alert('You must be logged in as admin to add books.');
                if (typeof window.showAdminLogin === 'function') {
                    window.showAdminLogin();
                }
                return false;
            }

            // Get form inputs
            const nameInput = document.getElementById('bookName');
            const typeInput = document.getElementById('bookType');
            const categoryInput = document.getElementById('bookCategory');
            const descriptionInput = document.getElementById('bookDescription');
            const bookFileInput = document.getElementById('bookFile');
            
            const title = nameInput ? nameInput.value.trim() : '';
            const bookType = typeInput ? typeInput.value : '';
            const category = categoryInput ? categoryInput.value : '';
            const description = descriptionInput ? descriptionInput.value.trim() : '';
            
            // Validation: Required fields
            if (!title || !bookType || !category) {
                alert('Please fill in book name, book type, and category.');
                return false;
            }
            
            // Validation: Book file is required
            if (!bookFileInput || !bookFileInput.files || !bookFileInput.files[0]) {
                alert('Please select a book file (PDF or audio).');
                return false;
            }
            
            const bookFile = bookFileInput.files[0];
            
            // Validate book file type matches selected type
            const isAudioFile = bookFile.type.startsWith('audio/') || 
                               bookFile.name.toLowerCase().endsWith('.mp3') ||
                               bookFile.name.toLowerCase().endsWith('.wav') ||
                               bookFile.name.toLowerCase().endsWith('.ogg');
            const isPdfFile = bookFile.type === 'application/pdf' || 
                             bookFile.name.toLowerCase().endsWith('.pdf');
            
            if (bookType === 'audio' && !isAudioFile) {
                alert('Please select an audio file (MP3, WAV, or OGG).');
                return false;
            }
            
            if (bookType === 'pdf' && !isPdfFile) {
                alert('Please select a PDF file.');
                return false;
            }
            
            // Validate file size (max 100MB)
            const MAX_FILE_SIZE = 100 * 1024 * 1024; // 100MB
            if (bookFile.size > MAX_FILE_SIZE) {
                alert(`File size (${(bookFile.size / (1024 * 1024)).toFixed(2)}MB) exceeds maximum of 100MB.`);
                return false;
            }
            
            // Get submit button and disable it
            const submitBtn = document.getElementById('submitBookBtn');
            if (!submitBtn) {
                console.error('Submit button not found');
                return false;
            }
            
            const originalBtnText = submitBtn.innerHTML;
            submitBtn.disabled = true;
            submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Uploading...';
            
            let fileUrl = '';
            const fileType = bookType; // Use the selected book type
            
            try {
                // STEP 1: Upload book file to Supabase Storage
                if (window.uploadService && window.uploadService.uploadFile) {
                    const uploadResult = await window.uploadService.uploadFile(bookFile, 'books');
                    if (uploadResult && uploadResult.success) {
                        fileUrl = uploadResult.url;
                        console.log('Book file uploaded:', fileUrl);
                    } else {
                        throw new Error('Failed to upload book file');
                    }
                } else {
                    throw new Error('Upload service not available');
                }
                
                // STEP 2: Insert record into books table
                // Normalize category to lowercase for consistency
                const normalizedCategory = category ? category.toLowerCase() : 'others';
                const bookData = {
                    title: title,
                    author: '', // No author field in new form
                    category: normalizedCategory,
                    description: description || null,
                    cover_url: null, // No cover image in new form
                    file_url: fileUrl,
                    file_type: fileType
                };
                
                const supabase = getSupabaseClient();
                if (!supabase) {
                    throw new Error('Supabase client not available');
                }
                
                const { data, error } = await supabase
                    .from('books')
                    .insert([bookData])
                    .select();
                
                if (error) {
                    throw error;
                }
                
                if (data && data.length > 0) {
                    console.log('Book uploaded successfully');
                    
                    // STEP 4: Refresh library list
                    loadBooksFromStorage('all', false);
                    
                    // Close modal and reset form
                    window.closeAddBookModal();
                    alert('Book added successfully!');
                } else {
                    throw new Error('No data returned from insert');
                }
                
            } catch (error) {
                console.error('Error adding book:', error);
                alert('Error: Failed to add book. ' + (error.message || 'Please try again.'));
            } finally {
                // Re-enable submit button
                submitBtn.disabled = false;
                submitBtn.innerHTML = originalBtnText;
            }
        };


        // Delete book function - admin only
        window.deleteBook = async function(bookId) {
            const adminStatus = localStorage.getItem('isAdminLoggedIn') === 'true';
            if (!adminStatus) {
                alert('You must be logged in as admin to delete books.');
                return;
            }
            
            // Sanitize bookId to prevent XSS
            const safeBookId = sanitizeHTML(bookId.toString());
            
            // Use custom confirm dialog (mobile-friendly)
            if (!confirm('Are you sure you want to delete this book? This action cannot be undone.')) {
                return;
            }
            
            const adminPassword = prompt('Enter admin password to confirm deletion:');
            if (!adminPassword || adminPassword !== 'kiuma2025') {
                if (adminPassword) {
                    alert('Incorrect password.');
                }
                return;
            }
            
            try {
                const supabase = getSupabaseClient();
                if (!supabase) {
                    throw new Error('Supabase client not available');
                }
                
                console.log('Attempting to delete book with ID:', safeBookId);
                
                // Delete from Supabase - simple and direct
                const { data, error } = await supabase
                    .from('books')
                    .delete()
                    .eq('id', safeBookId)
                    .select();
                
                if (error) {
                    console.error('Supabase delete error:', error);
                    throw error;
                }
                
                console.log('Book deleted successfully from Supabase:', data);
                
                // Remove from cache immediately
                cachedBooks = cachedBooks.filter(book => {
                    const bookIdStr = book.id?.toString() || '';
                    const supabaseIdStr = book.supabaseId?.toString() || '';
                    return bookIdStr !== safeBookId && supabaseIdStr !== safeBookId;
                });
                
                // Update localStorage cache
                try {
                    localStorage.setItem('cachedBooks', JSON.stringify(cachedBooks));
                } catch (e) {
                    console.log('Cache save failed:', e);
                }
                
                // Update UI immediately
                const currentCategory = document.querySelector('.category-card.active')?.dataset.category || 'all';
                const adminStatus = localStorage.getItem('isAdminLoggedIn') === 'true';
                displayBooks(cachedBooks, currentCategory, adminStatus);
                
                // Refresh from database in background
                setTimeout(() => {
                    loadBooksFromStorage(currentCategory, false);
                }, 500);
                
                alert('Book deleted successfully!');
            } catch (error) {
                console.error('Error deleting book:', error);
                alert('Error: Failed to delete book. ' + (error.message || 'Please try again.'));
            }
        };

        // Helper function to clear old books (keeps last N items)
        window.clearOldBooks = function(keepCount = 10) {
            const adminStatus = localStorage.getItem('isAdminLoggedIn') === 'true';
            if (!adminStatus) {
                alert('You must be logged in as admin to clear books.');
                return;
            }
            
            if (!confirm(`This will keep only the ${keepCount} most recent books. Continue?`)) {
                return;
            }
            
            try {
                let libraryData = JSON.parse(localStorage.getItem('libraryData') || '[]');
                if (libraryData.length <= keepCount) {
                    alert('No old books to clear. You have ' + libraryData.length + ' books.');
                    return;
                }
                
                const removed = libraryData.length - keepCount;
                libraryData = libraryData.slice(0, keepCount); // Keep only the first N (most recent)
                localStorage.setItem('libraryData', JSON.stringify(libraryData));
                
                // Reload books display
                loadBooksFromStorage();
                alert(`Cleared ${removed} old books. Kept ${keepCount} most recent books.`);
            } catch (e) {
                console.error('Error clearing old books:', e);
                alert('Error clearing books. Please try again.');
            }
        };

        // Sanitize HTML to prevent XSS
        function sanitizeHTML(str) {
            if (!str) return '';
            const div = document.createElement('div');
            div.textContent = str;
            return div.innerHTML;
        }
        
        // Sanitize URL to prevent XSS
        function sanitizeURL(url) {
            if (!url) return '';
            // Basic URL validation - only allow http/https/data URLs
            try {
                const urlObj = new URL(url);
                if (!['http:', 'https:', 'data:'].includes(urlObj.protocol)) {
                    return '';
                }
                return url;
            } catch (e) {
                // If URL parsing fails, return empty
                return '';
            }
        }
        
        // Get Supabase client
        let supabaseClient = null;
        function getSupabaseClient() {
            if (supabaseClient) return supabaseClient;
            if (typeof initializeSupabase === 'function') {
                supabaseClient = initializeSupabase();
            } else if (typeof supabase !== 'undefined' && window.supabaseConfig) {
                try {
                    supabaseClient = supabase.createClient(
                        window.supabaseConfig.supabaseUrl,
                        window.supabaseConfig.supabaseAnonKey
                    );
                } catch (e) {
                    console.error('Error creating Supabase client:', e);
                }
            }
            return supabaseClient;
        }
        
        
        // Validate file before upload
        function validateBookFile(file) {
            const MAX_FILE_SIZE = 100 * 1024 * 1024; // 100MB
            const allowedTypes = ['application/pdf', 'application/epub+zip', 'application/x-mobipocket-ebook'];
            
            // Check file size
            if (file.size > MAX_FILE_SIZE) {
                return { valid: false, error: `File size (${(file.size / (1024 * 1024)).toFixed(2)}MB) exceeds maximum allowed size of 100MB.` };
            }
            
            // Check file type
            const isValidType = allowedTypes.includes(file.type) || file.name.toLowerCase().endsWith('.pdf') || file.name.toLowerCase().endsWith('.epub');
            if (!isValidType) {
                return { valid: false, error: `File type "${file.type || file.name}" is not supported. Please upload a PDF or EPUB file.` };
            }
            
            return { valid: true };
        }
        
        // Track if we've already logged API warnings (reduce console noise)
        let cachedBooks = []; // Cache books for instant filtering
        
        /**
         * Load library items from Supabase (read-only)
         * Uses books table exclusively
         */
        async function loadBooksFromStorage(category = 'all', showLoading = true) {
            const adminStatus = localStorage.getItem('isAdminLoggedIn') === 'true';
            const libraryGrid = document.getElementById('libraryGrid');
            
            if (!libraryGrid) {
                console.error('Library grid not found');
                return;
            }
            
            // Try to load from localStorage cache first (instant display)
            if (cachedBooks.length === 0) {
                try {
                    const cached = localStorage.getItem('cachedBooks');
                    if (cached) {
                        cachedBooks = JSON.parse(cached);
                        if (cachedBooks.length > 0) {
                            displayBooks(cachedBooks, category, adminStatus);
                            showLoading = false; // Already showing cached data
                        }
                    }
                } catch (e) {
                    console.log('Cache load failed:', e);
                }
            } else if (showLoading) {
                // Show cached data immediately if available
                displayBooks(cachedBooks, category, adminStatus);
                showLoading = false;
            }
            
            // Show loading state if grid is empty
            if (showLoading) {
                const existingItems = Array.from(libraryGrid.querySelectorAll('.media-item[data-id]'));
                if (existingItems.length === 0) {
                    const loadingDiv = document.createElement('div');
                    loadingDiv.style.cssText = 'grid-column: 1/-1; text-align: center; padding: 40px; color: #999;';
                    loadingDiv.innerHTML = '<i class="fas fa-spinner fa-spin" style="font-size: 48px; margin-bottom: 10px;"></i><p>Loading books...</p>';
                    loadingDiv.id = 'booksLoadingDiv';
                    libraryGrid.appendChild(loadingDiv);
                } else {
                    // Clear existing items
                    existingItems.forEach(item => item.remove());
                }
            }
            
            // Fetch from Supabase books table (exclusive, no fallbacks)
            let books = [];
            let fetchError = null;
            
            try {
                const supabase = getSupabaseClient();
                if (!supabase) {
                    throw new Error('Supabase client not initialized');
                }
                
                // Build query: select all from books, ordered by created_at DESC
                // DO NOT filter by category here - fetch all books and filter client-side
                let query = supabase
                    .from('books')
                    .select('*')
                    .order('created_at', { ascending: false });
                
                // Execute query with timeout protection
                const timeoutPromise = new Promise((_, reject) => 
                    setTimeout(() => reject(new Error('Request timeout: Please check your connection')), 10000)
                );
                
                const { data, error } = await Promise.race([
                    query,
                    timeoutPromise.then(() => ({ data: null, error: new Error('Request timeout') }))
                ]);
                
                if (error) {
                    throw error;
                }
                
                if (data) {
                    // Log fetched items for verification
                    console.log('Fetched library items from Supabase:', data.length, 'items');
                    if (data.length > 0) {
                        console.log('Sample item:', data[0]);
                    }
                    
                    // Map Supabase data to book objects
                    books = data.map(item => ({
                        id: item.id?.toString() || '',
                        title: item.title || '',
                        author: item.author || '',
                        description: item.description || '',
                        category: item.category || 'other',
                        cover_image_url: item.cover_url || item.cover_image_url || '',
                        file_url: item.file_url || '',
                        isbn: item.isbn || '',
                        supabaseId: item.id?.toString() || ''
                    }));
                }
            } catch (error) {
                fetchError = error;
                console.error('Error fetching library items from Supabase:', error);
            }
            
            // Update cache
            cachedBooks = books;
            
            // Save to localStorage for instant load next time (with quota handling)
            try {
                localStorage.setItem('cachedBooks', JSON.stringify(cachedBooks));
            } catch (e) {
                console.log('Cache save failed:', e);
                // If quota exceeded, try to clear old cache
                if (e.name === 'QuotaExceededError') {
                    try {
                        const limitedCache = cachedBooks.slice(0, 50);
                        localStorage.setItem('cachedBooks', JSON.stringify(limitedCache));
                    } catch (e2) {
                        console.error('Error clearing cache:', e2);
                    }
                }
            }
            
            // Remove loading indicator
            const loadingDiv = document.getElementById('booksLoadingDiv');
            if (loadingDiv) {
                loadingDiv.remove();
            }
            
            // Handle states: success, empty, or error
            if (fetchError) {
                // Error state: show user-friendly message
                const errorDiv = document.createElement('div');
                errorDiv.style.cssText = 'grid-column: 1/-1; text-align: center; padding: 40px; color: #999;';
                errorDiv.innerHTML = `
                    <i class="fas fa-exclamation-circle" style="font-size: 48px; margin-bottom: 10px; opacity: 0.5; color: #f44336;"></i>
                    <p style="margin-bottom: 10px;">Unable to load books. Please check your connection.</p>
                    <button onclick="loadBooksFromStorage('${category}', true)" class="btn btn-primary" style="margin-top: 10px; padding: 8px 16px;">
                        <i class="fas fa-redo"></i> Retry
                    </button>
                `;
                libraryGrid.appendChild(errorDiv);
            } else if (books.length === 0) {
                // Empty state: no books available
                displayBooks([], category, adminStatus);
            } else {
                // Success state: display books
                displayBooks(cachedBooks, category, adminStatus);
            }
        }
        
        // Display books (instant, no loading)
        function displayBooks(books, category = 'all', adminStatus = false) {
            const libraryGrid = document.getElementById('libraryGrid');
            if (!libraryGrid) return;
            
            // Update category counts
            updateCategoryCounts(books);
            
            // Filter by category (client-side, instant)
            let filtered = books;
            if (category !== 'all') {
                filtered = books.filter(book => {
                    const bookCategory = (book.category || 'others').toLowerCase();
                    return bookCategory === category.toLowerCase();
                });
            }
            
            // Remove loading indicator
            const loadingDiv = document.getElementById('booksLoadingDiv') || 
                              libraryGrid.querySelector('div[style*="grid-column: 1/-1"]');
            if (loadingDiv) {
                loadingDiv.remove();
            }
            
            // Clear existing items
            const existingItems = Array.from(libraryGrid.querySelectorAll('.media-item[data-id]'));
            existingItems.forEach(item => item.remove());
            
            if (filtered.length === 0) {
                const emptyDiv = document.createElement('div');
                emptyDiv.style.cssText = 'grid-column: 1/-1; text-align: center; padding: 40px; color: #999;';
                const categoryName = category === 'all' ? '' : category.charAt(0).toUpperCase() + category.slice(1);
                emptyDiv.innerHTML = '<i class="fas fa-book" style="font-size: 48px; margin-bottom: 10px; opacity: 0.5;"></i><p>No books available yet' + (category !== 'all' ? ` in ${categoryName} category` : '') + '</p>';
                libraryGrid.appendChild(emptyDiv);
                return;
            }
            
            // Render books
            filtered.forEach(book => {
                const newBookItem = document.createElement('div');
                newBookItem.className = 'media-item';
                newBookItem.dataset.category = (book.category || 'others').toLowerCase();
                newBookItem.dataset.id = book.id;
                
                // Sanitize all inputs to prevent XSS
                const safeTitle = sanitizeHTML(book.title || '');
                const safeAuthor = sanitizeHTML(book.author || '');
                const safeDescription = sanitizeHTML(book.description || '');
                const safeCover = sanitizeURL(book.cover_image_url || '');
                const safeISBN = sanitizeHTML(book.isbn || '');
                const safeId = sanitizeHTML(book.id.toString());
                
                // Use Supabase public URL from books table (file_url column)
                let fileUrl = '';
                if (book.file_url && book.file_url.startsWith('http')) {
                    fileUrl = book.file_url;
                }
                
                // Default cover if no image provided
                const coverDisplay = safeCover ? 
                    `<img src="${safeCover}" alt="${safeTitle}" style="width: 100%; height: 200px; object-fit: cover;">` :
                    `<div style="width: 100%; height: 200px; background: linear-gradient(135deg, var(--primary-green), var(--dark-green)); display: flex; align-items: center; justify-content: center; color: white; font-size: 48px;"><i class="fas fa-book"></i></div>`;
                
                // Make entire card clickable if file_url exists
                const cardClickHandler = fileUrl ? `onclick="window.open('${fileUrl}', '_blank')" style="cursor: pointer;"` : '';
                
                newBookItem.innerHTML = `
                    <div ${cardClickHandler} style="width: 100%; height: 100%; position: relative; border-radius: 8px; overflow: hidden; background: white; box-shadow: 0 2px 8px rgba(0,0,0,0.1); display: flex; flex-direction: column;">
                        ${coverDisplay}
                        <div style="padding: 12px; flex: 1; display: flex; flex-direction: column;">
                            <h4 style="margin: 0 0 5px 0; font-size: 14px; font-weight: 600; color: var(--dark-gray); line-height: 1.3;">${safeTitle}</h4>
                            <p style="margin: 0 0 5px 0; font-size: 12px; color: var(--text-gray);">by ${safeAuthor}</p>
                            ${safeISBN ? `<p style="margin: 0 0 5px 0; font-size: 11px; color: var(--text-gray);">ISBN: ${safeISBN}</p>` : ''}
                            ${safeDescription ? `<p style="margin: 5px 0 0 0; font-size: 11px; color: var(--text-gray); line-height: 1.4; overflow: hidden; text-overflow: ellipsis; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical;">${safeDescription}</p>` : ''}
                            ${fileUrl ? `<div style="margin-top: 10px; padding: 8px 12px; background: var(--primary-green); color: white; text-align: center; border-radius: 5px; font-size: 12px;"><i class="fas fa-external-link-alt"></i> Open</div>` : ''}
                        </div>
                        ${adminStatus ? `<button onclick="event.stopPropagation(); deleteBook('${safeId}')" style="position: absolute; top: 8px; right: 8px; background: #f44336; color: white; border: none; border-radius: 50%; width: 40px; height: 40px; display: flex; align-items: center; justify-content: center; cursor: pointer; box-shadow: 0 2px 6px rgba(0,0,0,0.3); font-size: 14px; z-index: 10; touch-action: manipulation;" aria-label="Delete book">
                            <i class="fas fa-trash"></i>
                        </button>` : ''}
                    </div>
                `;

                libraryGrid.insertBefore(newBookItem, libraryGrid.firstChild);
            });
        }
        
        // Re-render books when admin status changes
        window.addEventListener('storage', function(e) {
            if (e.key === 'isAdminLoggedIn') {
                loadBooksFromStorage();
            }
        });
    </script>

    <!-- Admin Login Modal -->
    <div class="modal-overlay" id="adminLoginModal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-shield-alt"></i> Admin Login</h3>
                <button class="modal-close" onclick="closeAdminLogin()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <p style="margin-bottom: 15px;">Sign in with your account to access admin features.</p>
                <div class="form-group">
                    <label class="form-label">Email</label>
                    <input type="email" class="form-input" id="adminEmail" placeholder="Enter your email">
                </div>
                <div class="form-group">
                    <label class="form-label">Password</label>
                    <input type="password" class="form-input" id="adminPassword" placeholder="Enter your password">
                    <p id="passwordError" style="color: #f44336; font-size: 14px; margin-top: 5px; display: none;">Incorrect email or password.</p>
                </div>
                <div style="display: flex; gap: 10px; margin-top: 20px;">
                    <button class="btn btn-primary" onclick="if(typeof window.verifyAdminPassword==='function')window.verifyAdminPassword()" style="flex: 1;">
                        <i class="fas fa-sign-in-alt"></i> Login
                    </button>
                    <button class="btn btn-secondary" onclick="if(typeof window.closeAdminLogin==='function')window.closeAdminLogin()" style="flex: 1;">
                        Cancel
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Add Book Modal - Simple Mobile-First Form -->
    <div class="modal-overlay" id="addBookModal" style="display: none;">
        <div class="modal-content" style="max-width: 100%; width: 100%; margin: 0; border-radius: 0; height: 100vh; max-height: 100vh; display: flex; flex-direction: column;">
            <div class="modal-header" style="flex-shrink: 0;">
                <h3><i class="fas fa-book"></i> Add New Book</h3>
                <button class="modal-close" onclick="if(typeof window.closeAddBookModal==='function')window.closeAddBookModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body" style="flex: 1; overflow-y: auto; padding: 20px; padding-bottom: 100px;">
                <form id="uploadBookForm" onsubmit="event.preventDefault(); if(typeof window.addBook==='function'){window.addBook(event);} return false;" enctype="multipart/form-data">
                    <!-- Book Name -->
                    <div class="form-group" style="margin-bottom: 24px;">
                        <label class="form-label" style="font-size: 16px; font-weight: 600; margin-bottom: 10px; display: block; color: var(--dark-gray, #333);">Book Name *</label>
                        <input type="text" class="form-input" id="bookName" placeholder="Enter book name" required maxlength="200" style="width: 100%; padding: 16px; font-size: 16px; border: 2px solid #ddd; border-radius: 12px; box-sizing: border-box; -webkit-appearance: none; appearance: none;">
                    </div>
                    
                    <!-- Book Type -->
                    <div class="form-group" style="margin-bottom: 24px;">
                        <label class="form-label" style="font-size: 16px; font-weight: 600; margin-bottom: 10px; display: block; color: var(--dark-gray, #333);">Book Type *</label>
                        <select class="form-input" id="bookType" required style="width: 100%; padding: 16px; font-size: 16px; border: 2px solid #ddd; border-radius: 12px; box-sizing: border-box; -webkit-appearance: none; appearance: none; background-image: url(&quot;data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%23666' stroke-width='2'%3E%3Cpolyline points='6 9 12 15 18 9'%3E%3C/polyline%3E%3C/svg%3E&quot;); background-repeat: no-repeat; background-position: right 12px center; background-size: 20px; padding-right: 40px;">
                            <option value="">Select type</option>
                            <option value="pdf">PDF</option>
                            <option value="audio">Audio</option>
                        </select>
                    </div>
                    
                    <!-- Category -->
                    <div class="form-group" style="margin-bottom: 24px;">
                        <label class="form-label" style="font-size: 16px; font-weight: 600; margin-bottom: 10px; display: block; color: var(--dark-gray, #333);">Category *</label>
                        <select class="form-input" id="bookCategory" required style="width: 100%; padding: 16px; font-size: 16px; border: 2px solid #ddd; border-radius: 12px; box-sizing: border-box; -webkit-appearance: none; appearance: none; background-image: url(&quot;data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%23666' stroke-width='2'%3E%3Cpolyline points='6 9 12 15 18 9'%3E%3C/polyline%3E%3C/svg%3E&quot;); background-repeat: no-repeat; background-position: right 12px center; background-size: 20px; padding-right: 40px;">
                            <option value="">Select category</option>
                            <option value="quran">Quran</option>
                            <option value="yasaruna">Yasaruna</option>
                            <option value="hadith">Hadith</option>
                            <option value="tauheed">Tauheed</option>
                            <option value="swalah">Swalah</option>
                            <option value="others">Others</option>
                        </select>
                    </div>
                    
                    <!-- Description -->
                    <div class="form-group" style="margin-bottom: 24px;">
                        <label class="form-label" style="font-size: 16px; font-weight: 600; margin-bottom: 10px; display: block; color: var(--dark-gray, #333);">Description (Optional)</label>
                        <textarea class="form-input" id="bookDescription" rows="4" placeholder="Enter book description" maxlength="2000" style="width: 100%; padding: 16px; font-size: 16px; border: 2px solid #ddd; border-radius: 12px; resize: vertical; box-sizing: border-box; font-family: inherit; min-height: 100px;"></textarea>
                    </div>
                    
                    <!-- File Upload -->
                    <div class="form-group" style="margin-bottom: 24px;">
                        <label class="form-label" style="font-size: 16px; font-weight: 600; margin-bottom: 10px; display: block; color: var(--dark-gray, #333);">Upload File *</label>
                        <label for="bookFile" style="display: block; width: 100%; cursor: pointer; touch-action: manipulation;">
                            <input type="file" id="bookFile" name="bookFile" accept=".pdf,.mp3,.wav,.ogg,audio/*,application/pdf" required style="position: absolute; width: 1px; height: 1px; padding: 0; margin: -1px; overflow: hidden; clip: rect(0, 0, 0, 0); white-space: nowrap; border-width: 0;">
                            <div class="file-upload-button" style="width: 100%; padding: 20px; font-size: 16px; border: 2px dashed #ddd; border-radius: 12px; background: #f9f9f9; text-align: center; transition: all 0.2s; box-sizing: border-box;">
                                <i class="fas fa-cloud-upload-alt" style="font-size: 32px; color: var(--primary-green, #4CAF50); margin-bottom: 8px; display: block;"></i>
                                <span class="file-upload-text" style="color: var(--dark-gray, #333); font-weight: 600; display: block; margin-bottom: 4px;">Tap to select file</span>
                                <span class="file-upload-hint" style="color: #666; font-size: 14px; display: block;">PDF, MP3, WAV, or OGG (max 100MB)</span>
                                <span class="file-name-display" id="fileNameDisplay" style="display: none; margin-top: 8px; padding: 8px; background: white; border-radius: 6px; color: var(--primary-green, #4CAF50); font-size: 14px; font-weight: 600;"></span>
                            </div>
                        </label>
                        <style>
                            label[for="bookFile"]:hover .file-upload-button,
                            label[for="bookFile"]:active .file-upload-button {
                                border-color: var(--primary-green, #4CAF50);
                                background: #f0f8f0;
                            }
                            #bookFile:focus + .file-upload-button {
                                outline: 2px solid var(--primary-green, #4CAF50);
                                outline-offset: 2px;
                            }
                        </style>
                        <script>
                            // Update file name display when file is selected (non-intrusive)
                            (function() {
                                const fileInput = document.getElementById('bookFile');
                                const fileNameDisplay = document.getElementById('fileNameDisplay');
                                if (fileInput && fileNameDisplay) {
                                    fileInput.addEventListener('change', function(e) {
                                        if (e.target.files && e.target.files[0]) {
                                            fileNameDisplay.textContent = 'Selected: ' + e.target.files[0].name;
                                            fileNameDisplay.style.display = 'block';
                                        } else {
                                            fileNameDisplay.style.display = 'none';
                                        }
                                    });
                                }
                            })();
                        </script>
                    </div>
                </form>
            </div>
            
            <!-- Sticky Submit Button -->
            <div style="position: sticky; bottom: 0; left: 0; right: 0; background: white; padding: 16px 20px; border-top: 1px solid #eee; box-shadow: 0 -2px 10px rgba(0,0,0,0.1); z-index: 10; flex-shrink: 0;">
                <button type="submit" id="submitBookBtn" form="uploadBookForm" class="btn btn-primary" style="width: 100%; padding: 16px; font-size: 18px; font-weight: 600; border-radius: 12px; border: none; cursor: pointer; touch-action: manipulation;">
                    <i class="fas fa-upload"></i> Upload Book
                </button>
            </div>
        </div>
    </div>

    <!-- Floating Kizumu Visit Button -->
    <div class="floating-kizumu-btn" onclick="showActivitiesModal()">
        <i class="fas fa-heart"></i>
        <span>Kizumu Visit</span>
    </div>

    <!-- Activities Modal -->
    <div class="modal-overlay" id="activitiesModal" style="display: none;">
        <div class="modal-content activities-modal">
            <div class="modal-header">
                <h3><i class="fas fa-heart"></i> Important Activities</h3>
                <button class="modal-close" onclick="closeActivitiesModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="activities-modal-list">
                <div class="activity-modal-item" onclick="navigateToActivity('kizumu-visit')">
                    <div class="activity-modal-icon" style="background: #E91E63;">
                        <i class="fas fa-heart"></i>
                    </div>
                    <div class="activity-modal-text">
                        <h4>Kizumu Tahfiz Charity Visit</h4>
                        <p>Support Islamic education through charity visit</p>
                    </div>
                    <i class="fas fa-chevron-right"></i>
                </div>
                
                <div class="activity-modal-item" onclick="navigateToActivity('tuition-brothers')">
                    <div class="activity-modal-icon" style="background: var(--primary-green);">
                        <i class="fas fa-graduation-cap"></i>
                    </div>
                    <div class="activity-modal-text">
                        <h4>Tuition for Brothers</h4>
                        <p>Support brothers' education and learning</p>
                    </div>
                    <i class="fas fa-chevron-right"></i>
                </div>
                
                <div class="activity-modal-item" onclick="navigateToActivity('kisilaahe')">
                    <div class="activity-modal-icon" style="background: #9C27B0;">
                        <i class="fas fa-donate"></i>
                    </div>
                    <div class="activity-modal-text">
                        <h4>Donate to Kisilaahe</h4>
                        <p>Support Kisilaahe with essential items</p>
                    </div>
                    <i class="fas fa-chevron-right"></i>
                </div>
                
                <div class="activity-modal-item" onclick="navigateToActivity('activities')">
                    <div class="activity-modal-icon" style="background: #FF9800;">
                        <i class="fas fa-running"></i>
                    </div>
                    <div class="activity-modal-text">
                        <h4>View All Activities</h4>
                        <p>See all community activities and events</p>
                    </div>
                    <i class="fas fa-chevron-right"></i>
                </div>
            </div>
        </div>
    </div>
</body>
</html>


